/*! h5show - v1.0.0 - 2015-06-28
* Copyright (c) 2015 sandy; Licensed MIT */
!function(a,b){"use strict";function c(a,b){this.container=i(a),this.config=q({},C,b,this.container.dataset),this.initEventListeners(),this.init()}var d=function(){var b=a.createElement("dummy").style,c="Webkit Moz O ms Khtml".split(" "),d={};return function(a){if("undefined"==typeof d[a]){var e=a.charAt(0).toUpperCase()+a.substr(1),f=(a+" "+c.join(e+" ")+e).split(" ");d[a]=null;for(var g in f)if(void 0!==b[f[g]]){d[a]=f[g];break}}return d[a]}}(),e=function(a){return[].slice.call(a)},f=function(a,b){var c,e;for(c in b)b.hasOwnProperty(c)&&(e=d(c),null!==e&&(a.style[e]=b[c]));return a},g=function(a,b){return isNaN(a)?b||0:Number(a)},h=function(a,b){var c=b||!1;return null==a?c:"true"===a||a===!0?!0:!1},i=function(b){return a.getElementById(b)},j=function(b,c){return c=c||a,e(c.querySelectorAll(b))},k=function(b,c,d){var e=a.createEvent("CustomEvent");e.initCustomEvent(c,!0,!0,d),b.dispatchEvent(e)},l=function(){return b.location.hash.replace(/^#\/?/,"")},m=function(a){return function(){var b=arguments.length;if(b>=2){var c=Array.prototype.slice.call(arguments,1),d=arguments[0].classList;if(d)for(var e in c)d[a](c[e])}}},n=m("add"),o=m("remove"),p=function(a){return"object"!=typeof a?!1:a.constructor&&!hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},q=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!0;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"!=typeof g&&"function"!=typeof obj&&(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(p(c)||(b=Array.isArray(c)))?(b?(b=!1,f=a&&Array.isArray(a)?a:[]):f=a&&p(a)?a:{},g[d]=q(j,f,c)):void 0!==c&&(g[d]=c));return g},r=function(a,c,d){return a&&b.clearTimeout(a),b.setTimeout(d,1e3*c)},s=function(a){b.console&&b.console.warn(a)},t=1.5,u=1,v=function(a){var b=a.dataset,c={},d=[],e=[],g=function(a){return-1===a.indexOf("%")&&-1===a.indexOf("px")&&(a+="px"),a},h=function(a,b){var c=g(a),f=-1;-1===c.indexOf("-")?b.left=c:(b.right=c.substr(1),f=1),e&&d&&(b.marginLeft=j(d[0],e[0],f))},i=function(a,b){var c=g(a),f=-1;-1===c.indexOf("-")?b.top=c:(b.bottom=c.substr(1),f=1),e&&d&&(b.marginTop=j(d[1],e[1],f))},j=function(a,b,c){if(!a)return 0;var d=c||-1,e=a.indexOf("%")>=0?"%":"px",f=0,h=d*parseInt(a);return"center"===b?f=h/2:("right"===b||"bottom"===b)&&(f=h),g(f+e)},k=function(a){return"auto"===a};if(b.fontsize){var l=g(b.fontsize);l.indexOf("%")>=0&&(l=l.replace("%","vw")),c.fontSize=l}if(b.size?(d=b.size.split(","),1===d.length&&d.push(d[0]),d.length&&(k(d[0])||(c.width=g(d[0])),k(d[1])||(c.height=g(d[1])))):c.width="100%",b.origin&&(e=b.origin.split(","),1===e.length&&e.push(e[0])),b.pos){c.position="absolute";var m=b.pos.split(",");1===m.length&&m.push(m[0]),m.length&&(h(m[0],c),i(m[1],c))}b.time&&a.classList.add("hide"),b.bg&&(c.background=-1===b.bg.indexOf("#")?"url("+b.bg+") center center no-repeat":b.bg),b.color&&(c.color=b.color),b.opacity&&(c.opacity=b.opacity),f(a,c)},w=function(a,b,c){b!==c&&f(a,{animationDuration:b+"s",animationFillMode:"both"})},x=function(a,b){var c=a.indexOf(b);c>=0&&a.shift(c)},y=function(a){for(var c in a)b.clearTimeout(a[c]);a.length=0},z=function(a,c){var d=a.dataset,e=a.config;if(e.duration||(e.duration=u),d.time){var f=g(d.time);w(a,e.duration,u);var h=b.setTimeout(function(){o(a,"hide"),n(a,"animated",e.show),x(c,h)},1e3*f);if(c.push(h),d.showing){var i=b.setTimeout(function(){o(a,e.show),n(a,e.showing),x(c,i)},1e3*(f+e.duration));c.push(i)}if(d.stay){var j=g(d.stay),k=b.setTimeout(function(){if(o(a,e.show,e.showing),a.classList.contains("hiding"))n(a,e.hide);else{var b=e.hide||"hide";n(a,b)}x(c,k)},1e3*(f+e.duration+j));c.push(k)}}},A=function(a){var b=a.config;o(a,b.showing,b.show,b.hide),b.time&&n(a,"hide"),n(a,"hiding")},B=function(a){var b=a.config;o(a,b.showing,b.show,b.hide),b.time&&n(a,"hide")},C={play:!1,direction:"horizontal",indicator:!0,arrow:!1,index:0,urlHash:!1,page:{show:null,hide:null,duration:1.5},sprite:{show:"fadeIn",hide:"fadeOut",showing:null,duration:1}},D=".page",E="page-container",F="animated",G="page-active",H={toL:"pg-moveToLeft",toR:"pg-moveToRight",fromL:"pg-moveFromLeft",fromR:"pg-moveFromRight",toT:"pg-moveToTop",toB:"pg-moveToBottom",fromT:"pg-moveFromTop",fromB:"pg-moveFromBottom"},I="";c.prototype={init:function(){if(this.pageMap={},this.sprites={},this.spritesHandlers=[],this.hidePageHandler=null,this.playHandler=null,this.pages=j(D,this.container),this.pageCount=this.pages.length,this.container.classList.add(E),this.config.indicator=h(this.config.indicator),this.config.arrow=h(this.config.arrow),this.config.play=h(this.config.play),0!==this.pages.length){this.config.indicator&&this.initIndicator(),this.config.arrow&&this.initArrow();for(var a=0;a<this.pages.length;a++){var b=this.pages[a];b.inited=!1,b.idx=a,b.id||(b.id=this.container.id+"page"+(b.idx+1)),this.pageMap[b.id]=b}this.lastIdx=-1,this.idx=this.idxFromHash()||this.config.index,this["goto"](this.getPage(this.idx))}},initIndicator:function(){var b=a.createElement("ul"),c=this.config.indicator;("true"===c||c===!0)&&(c="horizontal"===this.config.direction?"bottom":"right"),n(b,"indicator","indicator-"+c);for(var d=0;d<this.pages.length;d++){var e=a.createElement("li");e.dataset.page=d,e.dataset.flag="indicator",b.appendChild(e)}this.container.appendChild(b),("left"===c||"right"===c)&&(b.style.top=b.offsetTop-b.clientHeight/2+"px"),this.indicator=b},initArrow:function(){var b="horizontal"===this.config.direction,c=this,d=function(b,d){var e=a.createElement("div"),f="";"prev"===b?f=d?"left":"top":"next"===b&&(f=d?"right":"bottom"),n(e,"arrow","arrow-"+f);var g=a.createElement("div");return g.dataset.flag="arrow",g.dataset.direction=b,n(g,"arrow-inner"),e.dataset.flag="arrow",e.dataset.direction=b,e.appendChild(g),c.container.appendChild(e),e};this.arrowPrev=d("prev",b),this.arrowNext=d("next",b)},initPage:function(a){var b=a.config=q({},this.config.page,a.dataset);b.stay=g(b.stay),b.duration=g(b.duration),b.arrow=h(b.arrow,!0),b.indicator=h(b.indicator,!0),w(a,b.duration,t);var c={};b.bg&&(c.background=-1===b.bg.indexOf("#")?"url("+b.bg+") center center no-repeat":b.bg),f(a,c),this.initSprites(a),a.inited=!0},initSprites:function(a){var b=a.querySelectorAll("*");if(b){this.sprites[a.id]=b;for(var c=0;c<b.length;c++){var d=b[c],e=d.config=q({},this.config.sprite,d.dataset);e.duration=g(e.duration),v(d)}}},initEventListeners:function(){var a=this;a.config.urlHash&&(b.addEventListener("hashchange",function(){a.setIdx(a.idxFromHash())},!1),a.container.addEventListener("h5show.pageEnter",function(c){var d="#/"+c.target.id;b.location.hash!==d?b.location.hash=I=d:a.setIdx(c.target.idx)},!1)),a.container.addEventListener("click",function(b){var c=b.target;if("li"===c.nodeName.toLowerCase()&&"indicator"===c.dataset.flag){var d=g(c.dataset.page);a["goto"](a.getPage(d))}else if("arrow"===c.dataset.flag){var e="prev"===c.dataset.direction?"prevPage":"nextPage";a[e]()}});var c=b.Hammer;if(void 0!==c){var d=new c(this.container);d.get("swipe").set({direction:c.DIRECTION_ALL}),d.on("swipe",function(b){b.direction===c.DIRECTION_RIGHT||b.direction===c.DIRECTION_DOWN?a.prevPage():a.nextPage()})}},"goto":function(a){a&&(this.config.urlHash?k(a,"h5show.pageEnter"):this.setIdx(a.idx))},idxFromHash:function(){var a=this.pageMap[l()];return a?a.idx:0},getPage:function(a){void 0===a&&(a=this.idx);var b=a>=0&&a<this.pageCount?this.pages[a]:this.pages[0];return b.inited||this.initPage(b),b},setIdx:function(a){return 0>a||a>this.pageCount-1?void s("idx:"+a+" is not valid !"):(this.idx=a,this.calcPageAnimation(),this.lastIdx>=0&&this.hidePage(this.lastIdx),this.showPage(a),this.config.indicator&&this.updateIndicator(a),void(this.config.arrow&&this.updateArrow(a)))},updateIndicator:function(a){if(this.config.indicator){n(this.indicator,"hide");var b=this.getPage(a);this.pageCount>1&&b.config.indicator&&o(this.indicator,"hide");var c=j("li",this.indicator);for(var d in c){var e=c[d];o(e,"active"),a===g(d)&&n(e,"active")}}},updateArrow:function(a){if(this.config.arrow&&(n(this.arrowPrev,"hide"),n(this.arrowNext,"hide"),0!==this.pageCount)){var b=this.getPage(a);this.pageCount>1&&b.config.arrow&&(a>0&&o(this.arrowPrev,"hide"),o(this.arrowNext,"hide"))}},hideSprites:function(a){var b=this.sprites[a.id];if(b)for(var c=0;c<b.length;c++){var d=b[c];A(d)}},resetSprites:function(a){var b=this.sprites[a.id];if(b)for(var c=0;c<b.length;c++){var d=b[c];B(d)}},hidePage:function(a){var b=this.getPage(a),c=this;if(b){var d=b.config;o(b,d._show),n(b,d._hide),r(c.hidePageHandler,d.duration,function(){c.idx!==a&&(o(b,G,F,d._hide),c.hideSprites(b))})}},calcPageAnimation:function(){if(1!==this.pageCount){var a=this.lastIdx>=0?this.getPage(this.lastIdx):null,b=a?a.config:null,c=this.getPage(this.idx),d=c.config,e="horizontal"===this.config.direction;o(c,d._hide),this.lastIdx<this.idx?(b&&(o(a,b._hide),b._hide=b.hide||(e?H.toL:H.toT)),d._show=d.show||(e?H.fromR:H.fromB)):(b&&(o(a,b._hide),b._hide=b.hide||(e?H.toR:H.toB)),d._show=d.show||(e?H.fromL:H.fromT))}},showSprites:function(a){for(var b=this.sprites[a.id],c=0;c<b.length;c++){var d=b[c];z(d,this.spritesHandlers)}},showPage:function(a){b.clearTimeout(this.playHandler);var c=this.getPage(a);n(c,F,G,c.config._show),this.resetSprites(c),y(this.spritesHandlers),this.showSprites(c),this.lastIdx=c.idx,this.prepareNext(a)},prepareNext:function(a){var b=this.getPage(a);if(this.config.play){var c=this;c.playHandler=r(c.playHandler,b.config.duration+c.calcPageStay(b),function(){c.nextPage()})}},calcPageStay:function(a){var b=a.config.stay,c=0,d=this.sprites[a.id];if(d&&d.length)for(var e in d){var f=d[e],h=f.config;if(h){var i=h.time?g(h.time):0;i+=h.stay?g(h.stay):0,c=Math.max(c,i+h.duration)}}return Math.max(b,c)},nextPage:function(){var a=this.idx<this.pageCount-1?this.idx+1:0;this["goto"](this.getPage(a))},prevPage:function(){if(this.idx>0){var a=this.idx-1;this["goto"](this.getPage(a))}}},b.H5Show=c}(document,window);